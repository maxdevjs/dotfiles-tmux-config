# https://dev.to/ggarnier/increasing-productivity-in-tmux-with-a-single-prefix-key-cib
#set -g 				prefix Home
#unbind 				C-b
#bind-key 			Home send-prefix 

# Reload config
unbind r
bind-key r source-file $HOME/.config/tmux/tmux.conf \;\
				display "Config reloaded..."

set -g                                  mouse on
set-option -g                           default-command $SHELL

# Vim mode
setw -g                                 mode-keys vi
# Decrease command delay (increase vim responsiveness)
set -sg                                 escape-time 1

# Zoom current pane
bind-key Home                           resize-pane -Z

# Increase scrollback lines
set -g                                  history-limit 100000

# Sessions
#bind-key C-K 			run-shell 'tmux switch-client -n \; kill-session -t "S(tmux display -p)" || tmux confirm kill-session'

#bind-key Tab			switch-client -n

# Windows

# Constrain window size to the maximum size of any client connected to that winfow,
#setw -g				aggressive-resize on

# Highlight window on new activity
#setw -g				monitor-activity on
#set -g				visual-activity on

#bind-key c 			new-window -c "#{pane_current_path}"
#bind-key C-k 			confirm kill-window

# Rename and renumber windows sequentially after closing any of them
setw -g				automatic-rename on
set -g 				renumber-windows on

# Start windows numbers at 1 to match keyboard order
set -g				base-index 1
set-window-option -g		pane-base-index 1

#bind-key -r C-h 		select-window -t :-
#bind-key -r C-l 		select-window -t :+

########
# Status bar
########
set -g 				status on
set -g				status-position top

# Set refresh interval
#set -g				status-interval 30

#set -g 				status-justify centre
#set -g 				status-right ''
#set-option -g 			status-left-length 50
#set -g 				status-left "Session: #S"

set-option -g 			status-right "#[fg=colour5]#(date '+%a, %b %d %Y - %I:%M')"
set -g status-left "#{pomodoro_status}"


########
# Panes
########
unbind %
bind |                                  split-window -h -c "#{pane_current_path}"
unbind '"'
bind -                                  split-window -v -c "#{pane_current_path}"

# Select pane
bind h                                  select-pane -L
bind j                                  select-pane -D
bind k                                  select-pane -U
bind l                                  select-pane -R

# Resize panes
bind -r H                               resize-pane -L 5 # 5 px bigger to the left
bind -r J                               resize-pane -D 5 # 5 px bigger down
bind -r K                               resize-pane -U 5 # 5 px bigger up
bind -r L                               resize-pane -R 5 # 5 px bigger to the right


# Switch to last pane
#bind-key C-a			last-pane

# Panes numeric indicators timer 
#set -g				display-panes-time 5000

# Message bar
#set -g 				message-style fg=terminal,bold,bg=terminal

# Current pane/window

#set -g 				window-status-current-style bg=terminal
#set -g 				window-status-current-style fg=red
#set -g 				window-status-current-format "@@@"

#set -g 				pane-border-style fg=colour240,bg=terminal
#set -g 				pane-active-border-style fg=green,bg=black

########
# Plugins
########

# Install
# - add plugin below
# - prefix + I

# Update
# - prefix U

# Remove
# - remove plugin line below
# - prefix + Alt + U

# List of plugins
# https://github.com/tmux-plugins/tpm/issues/260#issuecomment-1729803610
set-environment -g TMUX_PLUGIN_MANAGER_PATH "~/.config/tmux/plugins/"
# When tmux server is started with -f flag (tmux -f /some/path/to/conf.file)
# it will not load the new plugin syntax.
# This is my case, being tmux.conf in $HOME/.config/tmux (vulgo $XDG_CONFIG_HOME/tmux).
# set -g @plugin 'tmux-plugins/tpm' # Tmux package manager
# does not work. A workaround is suggested at:
# https://github.com/tmux-plugins/tpm/blob/master/docs/tpm_not_working.md
set -g @plugin 'tmux-plugins/tpm'

set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-yank'

set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @resurrect-strategy-nvim 'session'

set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @continuum-restore 'on'

set -g @plugin 'fcsonline/tmux-thumbs'

set -g @plugin 'sainnhe/tmux-fzf'
set -g @plugin 'wfxr/tmux-fzf-url'
set -g @fzf-url-fzf-options '-p 60%,30% --prompt="ÔÇé   " --border-label=" Open URL "'
set -g @fzf-url-history-limit '2000'

set -g @plugin 'olimorris/tmux-pomodoro-plus'
set -g @pomodoro_granularity 'on'
set -g status-interval 20
set -g @pomodoro_on "#[fg=$text_red]üçÖ"
set -g @pomodoro_complete "#[fg=$text_green]üçè"
set -g @pomodoro_pause "#[fg=$color_yellow]üí§"
set -g @pomodoro_prompt_break "#[fg=$color_green]üï§? "
set -g @pomodoro_prompt_pomodoro "#[fg=$color_gray]üï§? "
set -g @pomodoro_notifications 'on'
#set -g @pomodoro_interval_display "[%s/%s]"

# https://github.com/omerxx/dotfiles/blob/master/tmux/tmux.conf
set -g @plugin 'omerxx/tmux-sessionx'
set -g @sessionx-bind 'o'
set -g @sessionx-zoxide-mode 'on'
set -g @sessionx-filter-current 'false'
set -g @sessionx-preview-enabled 'true'
# Tmux will auto-start on system boot
# prefix + Ctrl-s - save
# prefix + Ctrl-r - restore
#set -g 			@continuum-boot 'on'
#set -g 			@continuum-boot-options 'iterm'
#set -g 				@continuum-restore 'on'
#set -g 				@continuum-save-interval '5'
# https://github.com/tmux-plugins/tmux-resurrect/blob/master/docs/restoring_pane_contents.md
#set -g 				@resurrect-capture-pane-contents 'on'
#set -g 				@resurrect-strategy-vim 'session'
#set -g 				@resurrect-strategy-nvim 'session' #for Neo Vim


#set -g 			@plugin 'tmux-plugins/tmux-sensible'
#set -g 			@plugin 'tmux-plugins/tmux-open' # Open highlighted selection directly from Tmux
#set -g 			@plugin 'tmux-plugins/tmux-resurrect' # Restore previous sessions on reboot
#set -g 			@plugin 'tmux-plugins/tmux-continuum' # Restore previous sessions on reboot
#set -g 			@plugin 'tmux-plugins/tmux-battery' #Show battery icon/status

# How to install other plugins from Github:
# To install new plugins press: prefix + I
# set -g @plugin 'github_username/plugin_name'
# set -g @plugin 'git@github.com/user/plugin'
# set -g @plugin 'git@bitbucket.com/user/plugin'

#TODO: tpm suddenly broken
# Plugins initialization
#set-environment -g DEFAULT_TPM_PATH "/home/max/.local/share/tmux/"
# Keep this line at the very bottom of tmux.conf

run "~/.config/tmux/plugins/tpm/tpm"


